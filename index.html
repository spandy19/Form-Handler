<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SISA Form</title>
  <style>
    form { max-width: 600px; margin: auto; }
    label { font-weight: normal; margin-bottom: 5px; }
    input, select {
      padding: 8px; border: 1px solid #ccc; border-radius: 5px; font-size: 14px;
    }
    button[type="submit"] {
      background-color: #0073e6; color: white; border: none;
      padding: 12px 24px; border-radius: 25px; font-size: 16px; cursor: pointer;
      transition: background 0.3s ease;
    }
    button[type="submit"]:hover { background-color: #005bb5; }
    .row { display: flex; gap: 15px; margin-bottom: 20px; }
    .row > div { flex: 1; display: flex; flex-direction: column; }
    .checkbox {
      display: flex; align-items: center; gap: 10px; margin: 15px 0;
    }
    .checkbox label { font-size: 15px; }
    .checkbox input[type="checkbox"] { transform: scale(1.2); cursor: pointer; }
    .terms {
      font-size: 12px; color: #555; margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <form id="sisaForm" method="post">
    <!-- Name Fields -->
    <div class="row">
      <div>
        <label>First Name *</label>
        <input type="text" name="First" required placeholder="First">
      </div>
      <div>
        <label>Last Name *</label>
        <input type="text" name="Last" required placeholder="Last">
      </div>
    </div>

    <!-- Organization & Email -->
    <div class="row">
      <div>
        <label>Organization *</label>
        <input type="text" name="Organization" required placeholder="Organization Name">
      </div>
      <div>
        <label>Work Email *</label>
        <input type="email" name="Work Email" required placeholder="Work Email">
      </div>
    </div>

    <!-- Contact & Country -->
    <div class="row">
      <div>
        <label>Contact No.</label>
        <input type="text" name="Contact No." placeholder="Contact No.">
      </div>
      <div>
        <label>Country *</label>
        <select name="Country" required>
          <option value="">Choose one</option>
          <option value="India">India</option>
          <option value="United States">United States</option>
          <option value="United Kingdom">United Kingdom</option>
          <option value="Australia">Australia</option>
        </select>
      </div>
    </div>

    <!-- UTM Source (hidden) -->
    <input type="hidden" name="utm_source" id="utm_source" value="">

    <!-- Opt-in -->
    <div class="checkbox">
      <input type="checkbox" name="opt_in" value="true">
      <label>I'm looking forward to receiving emails and newsletters from SISA</label>
    </div>

    <!-- Terms -->
    <p class="terms">
      By submitting this form, I agree to the 
      <a href="https://www.sisainfosec.com/terms-of-use/" target="_blank">Website Terms of Conditions</a> 
      and the <a href="https://www.sisainfosec.com/privacy-policy/" target="_blank">SISA Privacy Policy</a>.
    </p>

    <button type="submit">Submit</button>
  </form>

  <script>
    (function() {
      const params = new URLSearchParams(window.location.search);

      // 1. Set UTM
      const utmSource = params.get("utm_source");
      if (utmSource) document.getElementById("utm_source").value = utmSource;

      // 2. Dynamic endpoint from WordPress iframe
      const endpoint = params.get("endpoint");
      if (endpoint) document.getElementById("sisaForm").action = decodeURIComponent(endpoint);
      else console.warn("⚠️ No endpoint provided in URL, form action not set!");

      // 3. Handle redirect outside iframe
      const thankyou = params.get("thankyou");
      document.getElementById("sisaForm").addEventListener("submit", function() {
        setTimeout(function() {
          if (thankyou) {
            if (window.location !== window.parent.location) {
              // inside iframe → redirect parent
              window.parent.location.href = decodeURIComponent(thankyou);
            } else {
              // not in iframe → redirect current window
              window.location.href = decodeURIComponent(thankyou);
            }
          }
        }, 1500);
      });
    })();
  </script>
</body>
</html>
